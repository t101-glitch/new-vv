rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    function isAdmin() {
      return firestore.get(/databases/(default)/documents/users/$(request.auth.uid)).data.role == 'ADMIN';
    }

    match /user_uploads/{userId}/{allPaths=**} {
      // Allow read/write if the user is the owner OR an Admin
      // write includes: create, update, delete
      allow read, write: if request.auth != null && (
        request.auth.uid == userId || 
        isAdmin() || 
        request.auth.token.email == 'kosportz1@gmail.com'
      );
    }
  }
}
